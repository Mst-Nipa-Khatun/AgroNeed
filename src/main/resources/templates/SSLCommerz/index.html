<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SSLCommerz Easy Checkout</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        .payment-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .error-message {
            display: none;
            color: #dc3545;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="container payment-container">
    <h1 class="text-center mb-4">SSLCommerz Easy Checkout</h1>

    <div class="form-section">
        <h3>Payment Details</h3>
        <form id="paymentForm">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="amount" class="form-label">Amount (BDT)</label>
                    <input type="number" class="form-control" id="amount" name="amount" required min="1" step="0.01">
                </div>
                <div class="col-md-6">
                    <label for="productName" class="form-label">Product Name</label>
                    <input type="text" class="form-control" id="productName" name="productName" value="Test Product" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="customerName" class="form-label">Customer Name</label>
                    <input type="text" class="form-control" id="customerName" name="customerName" required>
                </div>
                <div class="col-md-6">
                    <label for="customerEmail" class="form-label">Email</label>
                    <input type="email" class="form-control" id="customerEmail" name="customerEmail" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="customerPhone" class="form-label">Phone</label>
                    <input type="text" class="form-control" id="customerPhone" name="customerPhone" required>
                </div>
                <div class="col-md-6">
                    <label for="customerCountry" class="form-label">Country</label>
                    <input type="text" class="form-control" id="customerCountry" name="customerCountry" value="Bangladesh" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-8">
                    <label for="customerAddress1" class="form-label">Address</label>
                    <input type="text" class="form-control" id="customerAddress1" name="customerAddress1" required>
                </div>
                <div class="col-md-4">
                    <label for="customerPostcode" class="form-label">Postcode</label>
                    <input type="text" class="form-control" id="customerPostcode" name="customerPostcode" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="customerCity" class="form-label">City</label>
                    <input type="text" class="form-control" id="customerCity" name="customerCity" required>
                </div>
                <div class="col-md-6">
                    <label for="productCategory" class="form-label">Product Category</label>
                    <select class="form-select" id="productCategory" name="productCategory">
                        <option value="general">General</option>
                        <option value="education">Education</option>
                        <option value="health">Health</option>
                        <option value="ecommerce">E-commerce</option>
                        <option value="utility">Utility</option>
                    </select>
                </div>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Proceed to Payment</button>
            </div>

            <div class="error-message" id="scriptLoadError">
                Failed to load payment gateway. Please try again later.
            </div>
        </form>
    </div>

    <div class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Processing payment...</p>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#paymentForm').on('submit', function (e) {
            e.preventDefault();

            $('.form-section').hide();
            $('.loading-spinner').show();
            $('#scriptLoadError').hide();

            const formData = {
                amount: $('#amount').val(),
                customerName: $('#customerName').val(),
                customerEmail: $('#customerEmail').val(),
                customerAddress1: $('#customerAddress1').val(),
                customerCity: $('#customerCity').val(),
                customerPostcode: $('#customerPostcode').val(),
                customerCountry: $('#customerCountry').val(),
                customerPhone: $('#customerPhone').val(),
                productName: $('#productName').val(),
                productCategory: $('#productCategory').val()
            };

            $.ajax({
                url: '/initiate-payment',   // Your backend API
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function (response) {
                    $('.loading-spinner').hide();

                    // Redirect checkout
                    if (response.data.GatewayPageURL) {
                        window.location.href = response.data.GatewayPageURL;
                    } else {
                        alert('Payment initialization failed: ' + response.data.failedreason);
                        $('.form-section').show();
                    }
                },
                error: function () {
                    alert('Payment initialization failed. Please try again.');
                    $('.loading-spinner').hide();
                    $('.form-section').show();
                }
            });
        });
    });
</script>
</body>
</html>
